---
title: 'SWEDEHEART Annual Report 2022 SwedeHF Appendix'
date: "Created: `r Sys.Date()`"
output:
  pdf_document:
    dev: cairo_pdf
    latex_engine: xelatex
    fig_caption: yes
    fig_height: 6
    fig_width: 6
    number_sections: no
urlcolor: blue
linkcolor: black
header-includes:
  - \usepackage{titling}
  - \pretitle{\begin{center}\LARGE\includegraphics[width=12cm]{logo.png}\\[\bigskipamount]}
  - \posttitle{\end{center}}
  - \usepackage{subfig}
  - \usepackage{fontspec}
  - \usepackage{fancyhdr} 
  - \pagestyle{fancy} 
  - \fancyhf{} 
  - \fancyfoot[R]{\thepage} 
  - \fancyfoot[L]{SWEDEHEART Annual Report 2022 SwedeHF Appendix} 
  - \newcommand{\epage}{\thispagestyle{empty}}
  - \renewcommand{\headrulewidth}{0pt}
  - \renewcommand{\footrulewidth}{1pt}
  - \usepackage{pdflscape}
  - \newcommand{\blandscape}{\begin{landscape}}
  - \newcommand{\elandscape}{\end{landscape}}
---

\epage

\newpage 
\tableofcontents 
\listoftables
\listoffigures
\newpage

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE, include = TRUE, comment = "",
  warning = FALSE, message = FALSE, fig.pos = "H",
  fig.path = "../output/figs/"
)
options(knitr.kable.NA = "")
```

```{r adjust_directory_if_needed, include=FALSE}
# Uncomment lines below if rmd file is placed in a subdirectory
knitr::opts_knit$set(root.dir = normalizePath("../"))
```

```{r load_project}
# 1. Set options in config/global.dcf
# 2. Load packages listed in config/global.dcf
# 3. Import functions and code in lib directory

ProjectTemplate::reload.project(data_loading = T)

cacheon <- TRUE
```             

# Information and explanations

The information presented is based on data reported in SwedeHF until 31st of January 2023. 

The presentation is based on the date of the patients visit/admission.

Index is defined as the first time a patient is registered in SwedeHF, not necessarily with newly diagnosed heart failure. Follow-up at 3 months can occur between 6 weeks and 6 months after index, with a mean time of 
`r formatC(mean(rsdata %>% filter(ttype == "3-month follow-up", indexyear == global_year) %>% pull(diff_timeadmission), na.rm = T) / 30.5, format = "f", digits = 1, decimal.mark = ".")` months from index for follow-up visits during `r global_year`. 

Yearly follow-up is divided into 1-year follow-up (from 6 months until 1.5 years after index), and 2+ years follow-up (from 1.5 years after index). The mean time from index until 1-year follow-up is 
`r formatC(mean(rsdata %>% filter(ttype == "1-year follow-up", indexyear == global_year) %>% pull(diff_timeadmission), na.rm = T) / 365.25, format = "f", digits = 1, decimal.mark = ".")` years and for 2+ years follow-up
`r formatC(mean(rsdata %>% filter(ttype == "2+-year follow-up", indexyear == global_year) %>% pull(diff_timeadmission), na.rm = T) / 365.25, format = "f", digits = 1, decimal.mark = ".")` years during `r global_year`. 

In cases where multiple yearly follow-up visits exist all visits have been presented. 
For 2+ years follow-up there are `r fnbm(rsdata %>% filter(ttype == "2+-year follow-up" & indexyear == global_year) %>% nrow())` observations for `r fnbm(rsdata %>% filter(ttype == "2+-year follow-up" & indexyear == global_year) %>% group_by(patientreference) %>% slice(1) %>% ungroup() %>% nrow())` 
unique patients during `r global_year`.  

Counties or centres with less than 10 observations in the denominator are not presented.

The R code that has generated this report is found https://github.com/KIHeartFailure/annualreportswedehf2022. 

\clearpage

# Coverage

**Numerator prevalent coverage:** Individuals registered in SwedeHF, 18 years 
of age at the time, alive as of the first of January of the current year and 
registered in SwedeHF sometime during the period from the start of the register 
in 2003 up to and including the end of the December of the year in question. 
For the years where information about the registration date is available 
in SwedeHF, i.e. from 2017 onwards, only the registrations received up to and 
including March 31 of the year following the relevant year are included.

**Denominator prevalent coverage:** Individuals aged 18 and alive on January 1 of the current year, with a registration for heart failure as the main diagnosis (I11.0, I13.0, I13.2, I25.5, I42.0, I42.6, I42.7, I50.0, I50.1, I50.9) in the National Patient Register up to and including the end of December of the year in question. 

*The coverage for `r global_year` is based on non-quality-reviewed data from the National Board of Health and Welfare. The definition of the coverage allows occurrence in SwedeHF after occurrence in the National Patient Register, which means that the coverage is not complete for `r global_year`. The coverage rate for `r global_year` should therefore be considered preliminary.*

**Numerator incident coverage:** Individuals in SwedeHF, over 18 years of age and with first registration during the year in question or with first registration within 1 year of the first heart failure diagnosis in the National Patient Register.

**Denominator incident coverage:** Individuals registered with heart failure (I11.0, I13.0, I13.2, I25.5, I42.0, I42.6, I42.7, I50.0, I50.1, I50.9) for the first time during the current year, either in SwedeHF or in the National Patient Register.

```{r, child = "./src/tg.Rmd"}
```

```{r, child = "./src/tg_bar.Rmd"}
```

\clearpage

# Registration

```{r, child = "./src/regovertime.Rmd"}
```

\clearpage

```{r, child = "./src/regovertimecum.Rmd"}
```

\clearpage

# Patient characteristics

```{r, child = "./src/tabs.Rmd"}
```

\blandscape

```{r desk, cache = cacheon, fig.cap = paste0("Patient characteristics at index, ", global_year), fig.show='hold', out.width="25%", fig.subcap=c('Sex', 'Age', 'NYHA class', 'LVEF'), fig.ncol=4}
piefunc(var = "sex", type = c("Index"))
piefunc(var = "age_cat", type = c("Index"))
piefunc(var = "FUNCTION_CLASS_NYHA", type = c("Index"))
piefunc(var = "ef_cat3", type = c("Index"))
```             

```{r enhetpie, cache = cacheon, fig.cap = paste0("Centre type, ", global_year), fig.show='hold', out.width="25%", fig.subcap=c('Index', '3-month follow-up', '1-year follow-up', '2+-year follow-up'), fig.ncol=4}
piefunc(var = "vtype", type = c("Index"))
piefunc(var = "vtype", type = c("3-month follow-up"))
piefunc(var = "vtype", type = c("1-year follow-up"))
piefunc(var = "vtype", type = c("2+-year follow-up"))
```     

\elandscape

```{r enhetbarindex, cache = cacheon, fig.cap = paste0("Centre type at index by county, ", global_year), fig.width=7, fig.height=8}
barfunc3(var = "location", type = "Index")
```             

```{r enhetbar, cache = cacheon, fig.cap = paste0("Centre type all registrations by county, ", global_year), fig.width=7, fig.height=8}
barfunc(var = "vtype", type = c("Index", "3-month follow-up", "1-year follow-up", "2+-year follow-up"))
```             

\clearpage

```{r, cache = cacheon}
qitmp <- "ferrtrans_available"
lltmp <- NULL
ultmp <- NULL
qinametmp <- "both transferrin and ferritin documented at index"
```             

```{r ferrtranstid, cache = cacheon, fig.cap = paste0("Trends in ", qinametmp, ", ", global_year - 4, "-", global_year), fig.width=9, fig.height=7}
timefunc(onlyindex = TRUE, starttime = global_year - 4, legplace = c(1, 92))
```             

```{r ferrtranscounty, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "county")
```             

```{r ferrtransenhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

\clearpage

# Quality Indicators

The quality indicators LVEF, NT-proBNP, NYHA class and QoL EQ-5D as well as planned follow-up at a heart failure clinic are defined at index. The treatment quality indicators, including physical exercise, are defined at the follow-up visit 3 months after index. 

The quality indicator follow-up visit at 3 months performed and documented 
is defined within the time frame `r paste0(global_year - 1, "-07-01 - ", global_year, "-07-01")`.

\clearpage

```{r, child = "./src/summaryqi.Rmd"}
```

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_lvef"
lltmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ll)
ultmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ul)
qinametmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(qiname)
```             

## Quality Indicator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", firstcap(qinametmp))` 

**Numerator:** Patients where LVEF has been documented, either semi quantitatively or as a percentage, at index. 

**Denominator:** All patients with an index registration.

```{r lveftid, cache = cacheon, fig.cap = paste0("Trends in ", qinametmp, ", ", global_year - 5, "-", global_year), fig.width=9, fig.height=7}
timefunc(onlyindex = TRUE)
```             

```{r lvefcounty, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "county")
```             

```{r lvefenhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_ntprobnp"
lltmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ll)
ultmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ul)
qinametmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(qiname)
```             

## Quality Indicator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", firstcap(qinametmp))` 

**Numerator:** Patients where NT-proBNP has been documented at index. For in-patient care, this can 
be either at enrollment or after 24 hours.

**Denominator:** All patients with an index registration.

```{r nttid, cache = cacheon, fig.cap = paste0("Trends in ", qinametmp, ", ", global_year - 5, "-", global_year), fig.width=9, fig.height=7}
timefunc(onlyindex = TRUE)
```             

```{r ntcounty, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "county")
```             

```{r ntenhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_nyha"
lltmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ll)
ultmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ul)
qinametmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(qiname)
```             

## Quality Indicator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", firstcap(qinametmp))` 

**Numerator:** Patients where NYHA class I, II, III, or IV has been documented at index. 

**Denominator:** All patients with an index registration.

```{r nyhatid, cache = cacheon, fig.cap = paste0("Trends in ", qinametmp, ", ", global_year - 5, "-", global_year), fig.width=9, fig.height=7}
timefunc(onlyindex = TRUE)
```             

```{r nyhacounty, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "county")
```             

```{r nyhaenhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_qol"
lltmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ll)
ultmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ul)
qinametmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(qiname)
```             

## Quality Indicator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", firstcap(qinametmp))` 

**Numerator:** Patients where an estimated state of health 
(quality of life score according to EQ-5D) has been assessed and documented at index.

**Denominator:** All patients with an index registration.

```{r qoltid, cache = cacheon, fig.cap = paste0("Trends in ", qinametmp, ", ", global_year - 5, "-", global_year), fig.width=9, fig.height=7}
timefunc(onlyindex = TRUE)
```             

```{r qolcounty, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "county")
```             

```{r qolenhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_uppfhf"
lltmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ll)
ultmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ul)
qinametmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(qiname)
```             

## Quality Indicator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", firstcap(qinametmp))` 

**Numerator:** Patients who, at the time of index, have a planned follow-up at a heart failure clinic. 

**Denominator:** All index registrations where the patient is alive at discharge and where information about planned follow-up has been documented.

```{r hfupptid, cache = cacheon, fig.cap = paste0("Trends in ", qinametmp, ", ", global_year - 5, "-", global_year), fig.width=9, fig.height=7}
timefunc(onlyindex = TRUE)
```             

```{r hfuppfcounty, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "county")
```             

```{r hfuppfenhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_followreg3m"
lltmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ll)
ultmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ul)
qinametmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(qiname)
```             

## Quality Indicator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", firstcap(qinametmp))` 

**Numerator:** Patients who have had a follow-up visit at 3 months (6 weeks - 6 months) after index performed and documented.

**Denominator:** All index registrations where the patient is alive at 3 months.

*In the figure `r paste0("Trends in ", qinametmp, ", ", global_year - 5, "-", global_year)` only index registrations until `r paste0(global_year, "-07-01")` are included in `r global_year`. In other presentations the time interval for the index is `r paste0(global_year - 1, "-07-01 - ", global_year, "-07-01")`.*

```{r uppf3tid, cache = cacheon, fig.cap = paste0("Trends in ", qinametmp, ", ", global_year - 5, "-", global_year), fig.width=9, fig.height=7}
timefunc(onlyindex = TRUE, legplace = c(1, 52))
```  

```{r uppf3county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " by county, ", global_year - 1, "/", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "county", startime = ymd(paste0(global_year - 1, "-07-01 - ")), stoptime = ymd(paste0(global_year, "-07-01")))
```             

```{r uppf3enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " by centre, ", global_year - 1, "/", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index", startime = ymd(paste0(global_year - 1, "-07-01 - ")), stoptime = ymd(paste0(global_year, "-07-01")))
```             

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_ras"
lltmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ll)
ultmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ul)
qinametmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(qiname)
```             

## Quality Indicator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", firstcap(qinametmp))` 

**Numerator:** Patients with LVEF < 40%, who are alive at discharge and 
where ACE inhibitors, ARBs or ARNIs has been prescribed.

**Denominator:** Patients with LVEF < 40%, who are alive at discharge and 
where information on the prescription of ACE inhibitors, ARBs 
and ARNIs has been documented. If LVEF is missing, last observation is carried forward. 

*The quality indicator is defined at the 3-month follow-up.*

```{r rastid, cache = cacheon, fig.cap = paste0("Trends in ", qinametmp, ", ", global_year - 5, "-", global_year), fig.width=9, fig.height=7}
timefunc(ylimmin = c(70, 100), legplace = c(1, 75))
```  

\blandscape
```{r rassjhpv, cache = cacheon, fig.cap = sanitize_text(paste0(firstcap(qinametmp), ", Sweden, hospital och primary care, ", global_year - 2, "-",  global_year)), fig.show='hold', out.width="33%", fig.subcap=c('Sweden', 'Hospital', 'Primary care'), fig.ncol=3}
barsummary(unit = c("Hospital", "Primary care"))
barsummary(unit = "Hospital")
barsummary(unit = "Primary care")
```             
\elandscape

```{r rasicounty, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at index by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "county")
```             

```{r rasienhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at index by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

```{r ras3county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 3-month follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "3-month follow-up", unit = "county")
```             

```{r ras3enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 3-month follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "3-month follow-up")
```             

```{r ras1county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 1-year follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "1-year follow-up", unit = "county")
```             

```{r ras1enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 1-year follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "1-year follow-up")
```             

```{r ras2county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 2+-year follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "2+-year follow-up", unit = "county")
```        

```{r ras2enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 2+-year follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "2+-year follow-up")
```        

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_arni"
lltmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ll)
ultmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ul)
qinametmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(qiname)
```             

## Quality Indicator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", firstcap(qinametmp))` 

**Numerator:** Patients with LVEF < 40%, who are alive at discharge and 
where ARNIs have been prescribed.

**Denominator:** Patients where LVEF < 40%, who are alive at discharge 
and where ACE inhibitors, ARBs or ARNIs have been prescribed. 
If LVEF is missing, last observation is carried forward. 

*The quality indicator is defined at the 3-month follow-up.*

```{r arnitid, cache = cacheon, fig.cap = paste0("Trends in ", qinametmp, ", ", global_year - 5, "-", global_year), fig.width=9, fig.height=7}
timefunc(legplace = c(1, 65))
```  

\blandscape
```{r arnisjhpv, cache = cacheon, fig.cap = sanitize_text(paste0(firstcap(qinametmp), ", Sweden, hospital och primary care, ", global_year - 2, "-",  global_year)), fig.show='hold', out.width="33%", fig.subcap=c('Sweden', 'Hospital', 'Primary care'), fig.ncol=3}
barsummary(unit = c("Hospital", "Primary care"))
barsummary(unit = "Hospital")
barsummary(unit = "Primary care")
```             
\elandscape

```{r arniicounty, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at index by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "county")
```             

```{r arniienhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at index by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

```{r arni3county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 3-month follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "3-month follow-up", unit = "county")
```             

```{r arni3enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 3-month follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "3-month follow-up")
```             

```{r arni1county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 1-year follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "1-year follow-up", unit = "county")
```             

```{r arni1enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 1-year follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "1-year follow-up")
```             

```{r arni2county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 2+-year follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "2+-year follow-up", unit = "county")
```        

```{r arni2enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 2+-year follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "2+-year follow-up")
```        


\clearpage

```{r, cache = cacheon}
qitmp <- "qi_bbl"
lltmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ll)
ultmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ul)
qinametmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(qiname)
```             

## Quality Indicator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", firstcap(qinametmp))` 

**Numerator:** Patients with LVEF < 40%, who are alive at discharge and 
where beta-blockers have been prescribed.

**Denominator:** Patients where LVEF < 40%, who are alive at discharge 
and where the prescription of beta-blockers has been documented. If LVEF is missing, last observation is carried forward. 

*The quality indicator is defined at the 3-month follow-up.*

```{r bbltid, cache = cacheon, fig.cap = paste0("Trends in ", qinametmp, ", ", global_year - 5, "-", global_year), fig.width=9, fig.height=7}
timefunc(ylimmin = c(70, 100), legplace = c(1, 75))
```  

\blandscape
```{r bllsjhpv, cache = cacheon, fig.cap = sanitize_text(paste0(firstcap(qinametmp), ", Sweden, hospital och primary care, ", global_year - 2, "-",  global_year)), fig.show='hold', out.width="33%", fig.subcap=c('Sweden', 'Hospital', 'Primary care'), fig.ncol=3}
barsummary(unit = c("Hospital", "Primary care"))
barsummary(unit = "Hospital")
barsummary(unit = "Primary care")
```             
\elandscape

```{r bblicounty, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at index by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "county")
```             

```{r bblienhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at index by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

```{r bbl3county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 3-month follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "3-month follow-up", unit = "county")
```             

```{r bbl3enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 3-month follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "3-month follow-up")
```             

```{r bbl1county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 1-year follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "1-year follow-up", unit = "county")
```             

```{r bbl1enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 1-year follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "1-year follow-up")
```             

```{r bbl2county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 2+-year follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "2+-year follow-up", unit = "county")
```        

```{r bbl2enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 2+-year follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "2+-year follow-up")
```        

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_mra"
lltmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ll)
ultmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ul)
qinametmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(qiname)
```             

## Quality Indicator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", firstcap(qinametmp))` 

**Numerator:** Patients with LVEF < 40%, who are alive at discharge and 
where MRA has been prescribed.

**Denominator:** Patients where LVEF < 40%, who are alive at discharge and 
where information on the prescription of MRA has been documented. If LVEF is missing, last observation is carried forward. 

*The quality indicator is defined at the 3-month follow-up.*

```{r mratid, cache = cacheon, fig.cap = paste0("Trends in ", qinametmp, ", ", global_year - 5, "-", global_year), fig.width=9, fig.height=7}
timefunc()
```  

\blandscape
```{r mrasjgpv, cache = cacheon, fig.cap = sanitize_text(paste0(firstcap(qinametmp), ", Sweden, hospital och primary care, ", global_year - 2, "-",  global_year)), fig.show='hold', out.width="33%", fig.subcap=c('Sweden', 'Hospital', 'Primary care'), fig.ncol=3}
barsummary(unit = c("Hospital", "Primary care"))
barsummary(unit = "Hospital")
barsummary(unit = "Primary care")
```             
\elandscape

```{r mraicounty, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at index by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "county")
```             

```{r mraienhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at index by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

```{r mra3county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 3-month follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "3-month follow-up", unit = "county")
```             

```{r mra3enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 3-month follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "3-month follow-up")
```             

```{r mra1county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 1-year follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "1-year follow-up", unit = "county")
```             

```{r mra1enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 1-year follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "1-year follow-up")
```             

```{r mra2county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 2+-year follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "2+-year follow-up", unit = "county")
```        

```{r mra2enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 2+-year follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "2+-year follow-up")
```        

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_trippel"
lltmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ll)
ultmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ul)
qinametmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(qiname)
```             

## Quality Indicator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", firstcap(qinametmp))` 

**Numerator:** Patients with LVEF < 40%, who are alive at discharge and 
where ACEI/ARB/ARNI, beta-blockers and MRA have been prescribed.

**Denominator:** Patients where LVEF < 40%, who are alive at discharge and 
where information on the prescription of ACEI/ARB/ARNI, Beta-blockers and MRA 
has been documented. If LVEF is missing, last observation is carried forward. 

*The quality indicator is defined at the 3-month follow-up.*

```{r trippeltid, cache = cacheon, fig.cap = paste0("Trends in ", qinametmp, ", ", global_year - 5, "-", global_year), fig.width=9, fig.height=7}
timefunc()
```  

\blandscape
```{r trippelsjhpv, cache = cacheon, fig.cap = sanitize_text(paste0(firstcap(qinametmp), ", Sweden, hospital och primary care, ", global_year - 2, "-",  global_year)), fig.show='hold', out.width="33%", fig.subcap=c('Sweden', 'Hospital', 'Primary care'), fig.ncol=3}
barsummary(unit = c("Hospital", "Primary care"))
barsummary(unit = "Hospital")
barsummary(unit = "Primary care")
```             
\elandscape

```{r tripplicounty, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at index by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "county")
```             

```{r trippelienhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at index by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

```{r trippel3county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 3-month follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "3-month follow-up", unit = "county")
```             

```{r trippel3enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 3-month follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "3-month follow-up")
```             

```{r trippel1county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 1-year follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "1-year follow-up", unit = "county")
```             

```{r trippel1enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 1-year follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "1-year follow-up")
```             

```{r trippel2county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 2+-year follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "2+-year follow-up", unit = "county")
```        

```{r trippel2enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 2+-year follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "2+-year follow-up")
```        

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_sglt2"
lltmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ll)
ultmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ul)
qinametmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(qiname)
```             

## Quality Indicator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", firstcap(qinametmp))` 

**Numerator:** Patients with LVEF < 40%, who are alive at discharge and 
where SGLT2 inhibitors have been prescribed.

**Denominator:** Patients where LVEF < 40%, who are alive at discharge and where 
information on the prescription of SGLT2 inhibitors has been documented. If LVEF is missing, last observation is carried forward. 

*The quality indicator is defined at the 3-month follow-up.*

```{r sglt2icounty, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at index by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "county")
```             

```{r sglt2ienhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at index by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

```{r sglt23county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 3-month follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "3-month follow-up", unit = "county")
```             

```{r sglt23enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 3-month follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "3-month follow-up")
```             

```{r sglt21county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 1-year follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "1-year follow-up", unit = "county")
```             

```{r sglt21enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 1-year follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "1-year follow-up")
```             

```{r sglt22county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 2+-year follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "2+-year follow-up", unit = "county")
```        

```{r sglt22enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 2+-year follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "2+-year follow-up")
```        

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_crt"
lltmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ll)
ultmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ul)
qinametmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(qiname)
```             

## Quality Indicator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", firstcap(qinametmp))` 

**Numerator:** Patients with LVEF $\leq$ 35% (LVEF as a percentage documented) 
or < 40% (semiquantitative LVEF documented) and with a CRT (with or without ICD) implanted.

**Denominator:** Patients with LVEF $\leq$ 35% (LVEF as a percentage documented) 
or < 40% (semiquantitative LVEF documented) and where information about device 
has been documented. In addition to this, left bundle branch block (LBBB) 
must be present and QRS duration must be > 130 ms. The denominator also 
includes patients with CRT implanted, regardless of QRS duration and LBBB values or 
if these are documented, which means that the proportion with CRT can be 
overestimated. If LVEF, QRS duration or LBBB are missing, last observation is carried forward. 

*The quality indicator is defined at the 3-month follow-up.*

```{r crttid, cache = cacheon, fig.cap = paste0("Trends in ", qinametmp, ", ", global_year - 5, "-", global_year), fig.width=9, fig.height=7}
timefunc()
```  

\blandscape
```{r crtsjhpv, cache = cacheon, fig.cap = sanitize_text(paste0(firstcap(qinametmp), ", Sweden, hospital och primary care, ", global_year - 2, "-",  global_year)), fig.show='hold', out.width="33%", fig.subcap=c('Sweden', 'Hospital', 'Primary care'), fig.ncol=3}
barsummary(unit = c("Hospital", "Primary care"))
barsummary(unit = "Hospital")
barsummary(unit = "Primary care")
```             
\elandscape

```{r crticounty, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at index by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "county")
```             

```{r crtienhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at index by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

```{r crt3county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 3-month follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "3-month follow-up", unit = "county")
```             

```{r crt3enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 3-month follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "3-month follow-up")
```             

```{r crt1county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 1-year follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "1-year follow-up", unit = "county")
```             

```{r crt1enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 1-year follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "1-year follow-up")
```             

```{r crt2county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 2+-year follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "2+-year follow-up", unit = "county")
```        

```{r crt2enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 2+-year follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "2+-year follow-up")
```        

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_icd"
lltmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ll)
ultmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ul)
qinametmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(qiname)
```             

## Quality Indicator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", firstcap(qinametmp))` 

**Numerator:** Patients with LVEF $\leq$ 35% (LVEF as a percentage documented) 
or < 40% (semiquantitative LVEF documented) and with a ICD (with or without CRT) implanted. 

**Denominator:** Patients with LVEF $\leq$ 35% (LVEF as a percentage documented) or < 40% (semiquantitative LVEF documented) and where information about device has been documented. If LVEF is missing, last observation is carried forward. 

*The quality indicator is defined at the 3-month follow-up.*

```{r icdtid, cache = cacheon, fig.cap = paste0("Trends in ", qinametmp, ", ", global_year - 5, "-", global_year), fig.width=9, fig.height=7}
timefunc(legplace = c(1, 90))
```  

\blandscape
```{r icdsjhpv, cache = cacheon, fig.cap = sanitize_text(paste0(firstcap(qinametmp), ", Sweden, hospital och primary care, ", global_year - 2, "-",  global_year)), fig.show='hold', out.width="33%", fig.subcap=c('Sweden', 'Hospital', 'Primary care'), fig.ncol=3}
barsummary(unit = c("Hospital", "Primary care"))
barsummary(unit = "Hospital")
barsummary(unit = "Primary care")
```             
\elandscape

```{r icdicounty, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at index by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "county")
```             

```{r icdienhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at index by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

```{r icd3county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 3-month follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "3-month follow-up", unit = "county")
```             

```{r icd3enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 3-month follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "3-month follow-up")
```             

```{r icd1county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 1-year follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "1-year follow-up", unit = "county")
```             

```{r icd1enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 1-year follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "1-year follow-up")
```             

```{r icd2county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 2+-year follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "2+-year follow-up", unit = "county")
```        

```{r icd2enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 2+-year follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "2+-year follow-up")
```        

\clearpage

```{r, cache = cacheon}
qitmp <- "qi_fys"
lltmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ll)
ultmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(ul)
qinametmp <- qiinfo %>%
  filter(qivar == qitmp) %>%
  pull(qiname)
```             

## Quality Indicator `r paste0(qiinfo %>% filter(qivar == qitmp) %>% pull(qino), ". ", firstcap(qinametmp))` 

**Numerator:** Patients with participation in organized physical exercise for HF.

**Denominator:** Patients where information about participation in organized 
physical exercise for HF has been documented. 

*The quality indicator is defined at the 3-month follow-up.*

```{r fystid, cache = cacheon, fig.cap = paste0("Trends in ", qinametmp, ", ", global_year - 5, "-", global_year), fig.width=9, fig.height=7}
timefunc(legplace = c(1, 90))
```  

\blandscape
```{r fyssjhpv, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), ", Sweden, hospital och primary care, ", global_year - 2, "-",  global_year), fig.show='hold', out.width="33%", fig.subcap=c('Sweden', 'Hospital', 'Primary care'), fig.ncol=3}
barsummary(unit = c("Hospital", "Primary care"))
barsummary(unit = "Hospital")
barsummary(unit = "Primary care")
```             
\elandscape

```{r fysicounty, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at index by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index", unit = "county")
```             

```{r fysienhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at index by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "Index")
```             

```{r fys3county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 3-month follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "3-month follow-up", unit = "county")
```             

```{r fys3enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 3-month follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "3-month follow-up")
```             

```{r fys1county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 1-year follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "1-year follow-up", unit = "county")
```             

```{r fys1enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 1-year follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "1-year follow-up")
```             

```{r fys2county, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 2+-year follow-up by county, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "2+-year follow-up", unit = "county")
```        

```{r fys2enhet, cache = cacheon, fig.cap = paste0(firstcap(qinametmp), " at the 2+-year follow-up by centre, ", global_year), fig.width=7, fig.height=8}
qifunc(type = "2+-year follow-up")
```        
